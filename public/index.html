<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
  <script src="/all.js"></script>
  <link rel="stylesheet" href="styles.css">

  <title>Timetable App</title>
</head>

<body>

  <div class="container mt-5">
  <h1 class="text-center mb-4">TIME TABLE - Jul-Dec 2023</h1>
   
  <!-- Batch Selection Dropdown -->
<div class="mb-4">
  <label for="batchSelect" class="form-label">Select Batch:</label>
  <select class="form-control" id="batchSelect">
    <option>Bachelor of Design UX V</option>
    <option>Bachelor of Design UX VII</option>
    <!-- Add more batches as needed -->
  </select>
</div>


<!-- Week Tabs -->
  <ul class="nav nav-tabs">
    <li class="nav-item">
      <a class="nav-link active" href="#week1" data-toggle="tab">Week 1</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#week2" data-toggle="tab">Week 2</a>
    </li>
    <!-- Add more weeks as needed -->
  </ul>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Week 1 Tab -->
    <div class="tab-pane active" id="week1">
      <h3 class="mt-3">Week 1: Oct 02, 2023 - Oct 06, 2023</h3>
      <!-- Week 1 Table Here -->
      <!-- Implement Week 1 Table -->
    </div>
    <!-- End Week 1 Tab -->
    <!-- Week 2 Tab -->
    <div class="tab-pane" id="week2">
      <h3 class="mt-3">Week 2: Oct 09, 2023 - Oct 13, 2023</h3>
      <!-- Week 2 Table Here -->
      <!-- Implement Week 2 Table -->
    </div>
    <!-- End Week 2 Tab -->
    <!-- Add similar blocks for other weeks -->
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>


    <table class="table table-bordered">
      <thead>
        <tr>
          <th scope="col">Day/Time</th>
          <th scope="col">9:45-10:35</th>
          <th scope="col">10:35-11:25</th>
          <th scope="col">11:25-12:15</th>
          <th scope="col">12:15-1:05</th>
          <th scope="col"></th>
          <th scope="col">1:35-2:25</th>
          <th scope="col">2:25-3:15</th>
        </tr>
      </thead>
      <tbody>
        <!-- Repeat this block for each day -->
        <tr>
          <th scope="row">Monday</th>
          <!-- Repeat this block for each time slot -->
          
          <td class="editable-cell" style="position:relative;" id="Monday-9:45-10:35">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
          

        
          
        <td class="editable-cell" style="position:relative;" id="Monday-10:35-11:25">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>


        <td class="editable-cell" style="position:relative;" id="Monday-11:25-12:15">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          


        <td class="editable-cell" style="position:relative;" id="Monday-12:15-1:05">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
          <!-- End time slot block -->
          <!-- Insert Break Cell for Monday Only -->
          <td rowspan="5" class="text-center text-secondary align-middle" style="writing-mode: vertical-rl; transform: rotate(180deg);">Break</td>
          <td class="editable-cell" style="position:relative;" id="Monday-1:35-2:25">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Monday-2:25-3:15">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        </tr>
        <tr>
          <th scope="row">Tuesday</th>
          <!-- Repeat this block for each time slot -->
          <td class="editable-cell" style="position:relative;" id="Tuesday-9:45-10:35">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Tuesday-10:35-11:25">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Tuesday-11:25-12:15">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Tuesday-12:15-1:05">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
          <!-- End time slot block -->
          <!-- Insert Break Cell for Monday Only -->
          
          <td class="editable-cell" style="position:relative;" id="Tuesday-1:35-2:25">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Tuesday-2:25-3:15">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

        </tr>

        <tr>
          <th scope="row">Wednesday</th>
          <!-- Repeat this block for each time slot -->
          <td class="editable-cell" style="position:relative;" id="Wednesday-9:45-10:35">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Wednesday-10:35-11:25">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Wednesday-11:25-12:15">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Wednesday-12:15-1:05">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
          <!-- End time slot block -->
          <!-- Insert Break Cell for Monday Only -->
          
          <td class="editable-cell" style="position:relative;" id="Wednesday-1:35-2:25">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Wednesday-2:25-3:15">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        </tr>

        <tr>
          <th scope="row">Thursday</th>
          <!-- Repeat this block for each time slot -->
          <td class="editable-cell" style="position:relative;" id="Thursday-9:45-10:35">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Thursday-10:35-11:25">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Thursday-11:25-12:15">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Thursday-12:15-1:05">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
          <!-- End time slot block -->
          <!-- Insert Break Cell for Monday Only -->
          
          <td class="editable-cell" style="position:relative;" id="Thursday-1:35-2:25">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Thursday-2:25-3:15">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        </tr>

        <tr>
          <th scope="row">Friday</th>
          <!-- Repeat this block for each time slot -->
          <td class="editable-cell" style="position:relative;" id="Friday-9:45-10:35">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Friday-10:35-11:25">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Friday-11:25-12:15">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Friday-12:15-1:05">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
          <!-- End time slot block -->
          <!-- Insert Break Cell for Monday Only -->
          
          <td class="editable-cell" style="position:relative;" id="Friday-1:35-2:25">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        <td class="editable-cell" style="position:relative;" id="Friday-2:25-3:15">
            <select class="custom-select subject-select" onchange="setSubject(this)">
                <option value="" disabled selected>Subject</option>
            </select>
            <i class="fa-solid fa-pen-to-square edit-icon hidden"></i>
        </td>

          
        </tr>

        <!-- End day block -->
        <!-- Add similar blocks for Tuesday to Friday -->
      </tbody>
    </table>
  </div>

 <script>
let subjectData = {}; // This will hold the fetched subject data

window.onload = function () {
  // Fetch subject data from the server
  fetch('http://localhost:3000/api/subjects')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok', response.statusText);
      }
      return response.json();
    })
    .then(data => {
  // Store fetched data in subjectData variable
  subjectData = data;
  // Populate select elements
  const selects = document.querySelectorAll('.subject-select');
  for (const select of selects) {
    for (const subject in data) {
      const option = document.createElement('option');
      option.text = subject; // subject is the key in your data object
      option.value = subject; // value can also be subject, adjust if you need a different value
      select.add(option);
    }
  }
  loadTimetableData(); // Call to load the initial timetable data
})

    .catch(error => {
      console.error('Error fetching the subjects:', error);
    });

  // Listen for changes on the batch select dropdown
  document.getElementById('batchSelect').addEventListener('change', function() {
    loadTimetableData();
  });

  // Add event listeners to all subject-select elements
  const subjectSelects = document.querySelectorAll('.subject-select');
  for (const select of subjectSelects) {
    select.addEventListener('change', function() {
      const selectedSubject = this.value;
      const selectedWeek = document.querySelector('.nav-link.active').innerText;
      const selectedBatch = document.getElementById('batchSelect').value;

      const cellIdParts = this.closest('td').id.split('-');
      const selectedDay = cellIdParts[0]; // replace this line with your actual code
      const selectedTime = cellIdParts[1] + '-' + cellIdParts[2]; // replace this line with your actual code

      // Send selected subject and time slot to server
      fetch('http://localhost:3000/api/update-slot', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          week: selectedWeek,
          batch: selectedBatch,
          day: selectedDay,
          time: selectedTime,
          subject: selectedSubject,
          // Include faculty if needed
        }),
      })
      .then(response => response.json())
      .then(data => console.log(data))
      .catch((error) => console.error('Error:', error));
    });
  }
};

function loadTimetableData() {
  const selectedWeek = document.querySelector('.nav-link.active').innerText;
  const selectedBatch = document.getElementById('batchSelect').value;

  // Fetch timetable data from the server for the selected week and batch
  fetch(`http://localhost:3000/api/timetable?week=${selectedWeek}&batch=${selectedBatch}`)
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok', response.statusText);
      }
      return response.json();
    })
    .then(data => {
      // Call the function here with fetched data
      populateTimetable(data);
    })
    .catch(error => {
      console.error('Error fetching the timetable:', error);
    });
}





function populateTimetable(data) {
  if (!data || !data.days) return;
  data.days.forEach(dayData => {
    if (!dayData.day || !dayData.slots) return;
    dayData.slots.forEach(slot => {
      const cell = document.querySelector(`#${dayData.day}-${slot.time}`);
      if (cell) {
        if (!slot.subject) {
          // Handle case when there is no subject for this slot
          // E.g., clear the cell content or set to a default value
          cell.textContent = ''; // or some default value
          return;
        }
        // Modify this part to adjust how data is displayed in the cell
        cell.textContent = slot.subject;
        // If you have a dropdown in the cell and you want to set it to the saved value, you might do something like this:
        const select = cell.querySelector('select');
        if (select) {
          select.value = slot.subject;
          // You might need additional logic here to hide the select and display the selected value, based on your UI design
        }
      }
    });
  });
}




document.body.addEventListener('click', function(e) {
    console.log('Clicked element:', e.target);
    console.log('Closest .edit-icon:', e.target.closest('.edit-icon'));
    if(e.target.closest('.edit-icon')) {
        e.stopPropagation();
        editSubject(e.target.closest('.edit-icon'));
    }
});


/* function setSubject(element) {
  const selectedSubject = element.value;
  element.style.display = 'none'; 
  const parentCell = element.parentNode;
  const displayDiv = document.createElement('div');
  displayDiv.innerHTML = '<strong>' + subjectData[selectedSubject] + '</strong><br>' + selectedSubject;
  parentCell.appendChild(displayDiv); 
  parentCell.classList.add('subject-selected');
  const editIcon = parentCell.querySelector('.edit-icon'); 
  editIcon.classList.remove('hidden'); 
  parentCell.classList.add('editable'); // Add this line
  saveSubject('someCellId', selectedSubject);
} */


function setSubject(element) {
    const selectedSubject = element.value;
    
    // Assuming that your time slot and day information is stored in the id of the parent td element
    // If this is not the case, adjust this part to get the correct time slot and day information
    const parentCellId = element.closest('td').id;
    const [day, startTime, endTime] = parentCellId.split('-');
    
    // Update UI
    element.style.display = 'none'; 
    const parentCell = element.parentNode;
    const displayDiv = document.createElement('div');
    displayDiv.innerHTML = '<strong>' + subjectData[selectedSubject] + '</strong><br>' + selectedSubject;
    /* displayDiv.textContent = selectedSubject; // Set text content to selected subject */
    parentCell.appendChild(displayDiv); 
    // Add any other UI updates needed here

    // Send selected subject, time slot, and day to server
    fetch('http://localhost:3000/api/update-slot', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            week: 'specified_week', // Replace with actual week value
            batch: 'specified_batch', // Replace with actual batch value
            day: day,
            time: `${startTime}-${endTime}`,
            subject: selectedSubject,
            faculty: 'specified_faculty' // Replace with actual faculty value or remove if not needed
        }),
    })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        // Handle success - you might want to update the UI to reflect that the data was saved successfully
    })
    .catch((error) => {
        console.error('Error:', error);
        // Handle error - you might want to show an error message to the user
    });
}



function editSubject(element) {
  const parentCell = element.parentNode;
  const selectElement = parentCell.querySelector('select');
  const displayDiv = parentCell.querySelector('div');

  // First, check if the elements are selected correctly
  if (!selectElement || !displayDiv) {
    console.error('Select element or display div not found in cell:', parentCell);
    return;
  }

  element.classList.add('hidden'); // Hide the edit icon
  displayDiv.remove(); // Remove the displayed subject
  selectElement.style.display = 'inline-block'; // Show the select element again
  selectElement.value = ""; // Reset the value of the select to the default state
}

function saveSubject(cellID, selectedSubject) {
  fetch('http://localhost:3000/api/update-slot', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      week: 'your_week',
      batch: 'your_batch',
      day: 'your_day',
      time: 'your_time',
      subject: selectedSubject,
      faculty: 'your_faculty', // You need to provide the faculty as well
    }),
  })
  .then(response => response.json())
  .then(data => console.log(data))
  .catch((error) => console.error('Error:', error));
}




</script>




</body>

</html>
